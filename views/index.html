<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Accueil</title>
<link rel="stylesheet" href="/css/style.css">
</head>
<body>
<header>Mon Twitter Clone</header>
<div class="container">
  <div class="logout">
    <a href="/profile">Profil</a> | 
    <a href="/groups">Groupes</a> | 
    <a href="/logout">Déconnexion</a>
  </div>
  <h2>Bienvenue, {{firstname}} {{lastname}}</h2>

  <!-- Nouveau message -->
  <div class="post">
    <form method="POST" action="/createMessage" id="messageForm">
      <input type="hidden" name="authorId" value="{{user_id}}">
      <input type="hidden" name="imageData" id="imageData">
      <textarea name="message" placeholder="Quoi de neuf ?" rows="3" required></textarea>
      <input type="file" id="imageUpload" accept="image/*">
      <button type="submit">Publier</button>
    </form>
  </div>
  <hr>
  {{posts}}
</div>

<script>
  // Gestion de l'upload d'image pour le message principal
  const form = document.getElementById('messageForm');
  const imageUpload = document.getElementById('imageUpload');
  const imageData = document.getElementById('imageData');

  imageUpload.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (event) => {
        imageData.value = event.target.result; // base64
      };
      reader.readAsDataURL(file);
    }
  });

  // Gestion de l'upload d'images pour les réponses
  document.querySelectorAll('.answer-form').forEach(form => {
    const imageUpload = form.querySelector('.answer-image-upload');
    const imageData = form.querySelector('.answer-image-data');
    
    if (imageUpload && imageData) {
      imageUpload.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            imageData.value = event.target.result; // base64
          };
          reader.readAsDataURL(file);
        }
      });
    }
  });
</script>
</body>
</html>